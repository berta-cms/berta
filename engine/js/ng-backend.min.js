!function(e,t){"use strict";e.sync=function(e,t,n){return n=n||"PATCH",fetch(e,{method:n,headers:{Accept:"application/json","Content-Type":"application/json"},body:"GET"===n?void 0:JSON.stringify(t)}).then(function(e){return e.json()})["catch"](function(e){console.log("Request failed:",e.message)})},e.getQueryParams=function(){var e=location.search.slice(1).split("&"),t={};return e.forEach(function(e){e[0]&&(e=e.split("="),t[e[0]]=decodeURIComponent(e[1]||""))}),t},e.getCurrentSite=function(){var e=getQueryParams();return void 0===e.site?"":e.site},e.escapeHTML=function(e){var n=t.createElement("div"),s=t.createTextNode(e);return n.appendChild(s),n.innerHTML},e.getAllTemplates=function(){var e=redux_store.getState().template_settings.toJSON();return Object.getOwnPropertyNames(e)};var n={templates:{}};n.load=function(){var e=t.getElementById("templateList");if(e){var n=Array.prototype.slice.call(e.querySelectorAll("script"),0);n.forEach(function(e,t){"text/template"===e.getAttribute("type")&&(this.templates[e.getAttribute("id")]=e.innerHTML)}.bind(this))}}.bind(n),n.get=function(e,t){var n=this.templates[e];return n.replace(/<\%=([^%>]+)\%>/g,function(e,n){return t[n]})}.bind(n),e.Templates=n,e.domReady=function(n){var s=!1,i=function(){t.addEventListener?(t.removeEventListener("DOMContentLoaded",E),e.removeEventListener("load",E)):(t.detachEvent("onreadystatechange",E),e.detachEvent("onload",E))},E=function(){s||!t.addEventListener&&"load"!==event.type&&"complete"!==t.readyState||(s=!0,i(),n())};if("complete"===t.readyState)n();else if(t.addEventListener)t.addEventListener("DOMContentLoaded",E),e.addEventListener("load",E);else{t.attachEvent("onreadystatechange",E),e.attachEvent("onload",E);var T=!1;try{T=null===e.frameElement&&t.documentElement}catch(r){}T&&T.doScroll&&!function a(){if(!s){try{T.doScroll("left")}catch(e){return setTimeout(a,50)}s=!0,i(),n()}}()}}}(window,document),function(e,t){"use strict";e.API_ROOT="/_api/v1/",e.editables={xEditable:"xEditable",xEditableColor:"xEditableColor",xEditableSelect:"xEditableSelect",xEditableSelectRC:"xEditableSelectRC",xEditableFontSelect:"xEditableFontSelect",xEditableImage:"xEditableImage",xEditableICO:"xEditableICO",xEditableTA:"xEditableTA",xEditableMCE:"xEditableMCE",xEditableMCESimple:"xEditableMCESimple",xEditableRC:"xEditableRC",xEditableYesNo:"xEditableYesNo",xEmpty:"xEmpty"},e.formats={text:editables.xEditable,longtext:editables.xEditableTA,richtext:editables.xEditableMCESimple,color:editables.xEditableColor,image:editables.xEditableImage,icon:editables.xEditableICO,select:editables.xEditableSelectRC,fontselect:editables.xEditableFontSelect}}(window,document),function(e,t){"use strict";e.ActionTypes={GET_STATE:"GET_STATE",SET_STATE:"SET_STATE",CREATE_SITE:"CREATE_SITE",SITE_CREATED:"SITE_CREATED",UPDATE_SITE:"UPDATE_SITE",SITE_UPDATED:"SITE_UPDATED",DELETE_SITE:"DELETE_SITE",SITE_DELETED:"SITE_DELETED",ORDER_SITES:"ORDER_SITES",UPDATE_SETTINGS:"UPDATE_SETTINGS",SETTINGS_UPDATED:"SETTINGS_UPDATED",SETTINGS_CREATED:"SETTINGS_CREATED",DELETE_SITE_SETTINGS:"DELETE_SITE_SETTINGS",SITE_SETTINGS_DELETED:"SITE_SETTINGS_DELETED",RENAME_SETTINGS_SITENAME:"RENAME_SETTINGS_SITENAME",UPDATE_SITE_TEMPLATE_SETTINGS:"UPDATE_SITE_TEMPLATE_SETTINGS",SITE_TEMPLATE_SETTINGS_UPDATED:"SITE_TEMPLATE_SETTINGS_UPDATED",TEMPLATE_SETTINGS_CREATED:"TEMPLATE_SETTINGS_CREATED",DELETE_SITE_TEMPLATE_SETTINGS:"DELETE_SITE_TEMPLATE_SETTINGS",SITE_TEMPLATE_SETTINGS_DELETED:"SITE_TEMPLATE_SETTINGS_DELETED",RENAME_SITE_TEMPLATE_SETTINGS_SITENAME:"RENAME_SITE_TEMPLATE_SETTINGS_SITENAME",CREATE_SECTION:"CREATE_SECTION",SECTION_CREATED:"SECTION_CREATED",UPDATE_SECTION:"UPDATE_SECTION",RESET_SECTION:"RESET_SECTION",SECTION_UPDATED:"SECTION_UPDATED",DELETE_SECTION:"DELETE_SECTION",DELETE_SITE_SECTIONS:"DELETE_SITE_SECTIONS",SECTION_DELETED:"SECTION_DELETED",ORDER_SECTIONS:"ORDER_SECTIONS",RENAME_SECTIONS_SITENAME:"RENAME_SECTIONS_SITENAME",SECTION_BG_DELETE:"SECTION_BG_DELETE",SECTION_BG_ORDER:"SECTION_BG_ORDER",SECTION_BG_ORDERED:"SECTION_BG_ORDERED",ADD_SITE_TAGS:"ADD_SITE_TAGS",ADD_SECTION_TAGS:"ADD_SECTION_TAGS",UPDATE_TAGS:"UPDATE_TAGS",RENAME_SECTION_TAGS:"RENAME_SECTION_TAGS",DELETE_SECTION_TAGS:"DELETE_SECTION_TAGS",RENAME_TAGS_SITENAME:"RENAME_TAGS_SITENAME",DELETE_SITE_TAGS:"DELETE_SITE_TAGS",SITE_TAGS_DELETED:"SITE_TAGS_DELETED"}}(window,document),function(e,t){"use strict";e.Actions=e.Actions||{},Object.assign(e.Actions,{getState:function(e){return e=e?e:"0",{type:ActionTypes.GET_STATE,meta:{remote:!0,url:"/_api/v1/state/"+e,dispatch:"setState"}}},setState:function(e){return{type:ActionTypes.SET_STATE,state:e}}})}(window,document),function(e,t){"use strict";e.Actions=e.Actions||{},Object.assign(e.Actions,{createSite:function(e,t){return function(n,s){n({type:ActionTypes.CREATE_SITE}),sync(API_ROOT+"create-site",{site:e},"POST").then(function(e){if(e.error_message);else{if(n(Actions.siteCreated(e.site)),e.settings&&n(Actions.settingsCreated(e.site.name,e.settings)),e.sections&&e.sections.length)for(var s=0;s<e.sections.length;s++)n(Actions.sectionCreated(e.sections[s]));e.tags&&e.tags.section&&n(Actions.addSiteTags({site_name:e.site.name,tags:e.tags})),e.siteTemplateSettings&&n(Actions.templateSettingsCreated(e.site.name,e.siteTemplateSettings))}t(e.site)})}},siteCreated:function(e){return{type:ActionTypes.SITE_CREATED,data:e}},renameSite:function(e,t,n){return function(s,i){s({type:ActionTypes.UPDATE_SITE}),s({type:ActionTypes.UPDATE_SECTION}),s({type:ActionTypes.UPDATE_SETTINGS}),s({type:ActionTypes.UPDATE_SITE_TEMPLATE_SETTINGS}),s({type:ActionTypes.UPDATE_TAGS}),sync(API_ROOT+"update-site",{path:e,value:t}).then(function(t){if(t.error_message);else{e=e.split("/");var E=parseInt(e[1],10),T=i().sites.find(function(e){return e.get("order")===E});s(Actions.siteUpdated(t)),s(Actions.renameSectionsSitename({site:T,site_name:t.value})),s(Actions.renameSettingsSitename({site:T,site_name:t.value})),s(Actions.renameSiteTemplateSettingsSitename({site:T,site_name:t.value})),s(Actions.renameTagsSitename({site:T,site_name:t.value}))}n(t)})}},updateSite:function(e,t,n){return{type:ActionTypes.UPDATE_SITE,meta:{remote:!0,url:API_ROOT+"update-site",method:"PATCH",data:{path:e,value:t},dispatch:"siteUpdated",onComplete:n},path:e,value:t}},siteUpdated:function(e){return{type:ActionTypes.SITE_UPDATED,resp:e}},deleteSite:function(e,t){return function(n,s){n({type:ActionTypes.DELETE_SITE}),n({type:ActionTypes.DELETE_SECTION}),n({type:ActionTypes.DELETE_SITE_SETTINGS}),n({type:ActionTypes.DELETE_SITE_TEMPLATE_SETTINGS}),n({type:ActionTypes.DELETE_SITE_TAGS}),sync(API_ROOT+"delete-site/"+encodeURIComponent(e),{},"DELETE").then(function(e){e.error_message||(n(Actions.siteDeleted(e)),n(Actions.deleteSiteSections({site_name:e.name})),n(Actions.deleteSiteSettings({site_name:e.name})),n(Actions.deleteSiteTemplateSettings({site_name:e.name})),n(Actions.deleteSiteTags({site_name:e.name}))),t(e)})}},siteDeleted:function(e){return{type:ActionTypes.SITE_DELETED,resp:e}},orderSites:function(e,t){return{type:ActionTypes.ORDER_SITES,meta:{remote:!0,method:"PUT",url:API_ROOT+"order-sites",data:e,onComplete:t},sites:e}}})}(window,document),function(e,t){"use strict";e.Actions=e.Actions||{},Object.assign(e.Actions,{updateSettings:function(e,t,n){return function(s,i){s({type:ActionTypes.UPDATE_SETTINGS}),sync(API_ROOT+"update-settings",{path:e,value:t}).then(function(e){e.error_message||s(Actions.settingsUpdated(e)),n(e)})}},settingsUpdated:function(e){return{type:ActionTypes.SETTINGS_UPDATED,resp:e}},settingsCreated:function(e,t){return{type:ActionTypes.SETTINGS_CREATED,site_name:e,data:t}},renameSettingsSitename:function(e){return{type:ActionTypes.RENAME_SETTINGS_SITENAME,data:e}},deleteSiteSettings:function(e){return{type:ActionTypes.SITE_SETTINGS_DELETED,data:e}}})}(window,document),function(e,t){"use strict";e.Actions=e.Actions||{},Object.assign(e.Actions,{updateSiteTemplateSettings:function(e,t,n){return function(s,i){s({type:ActionTypes.UPDATE_SITE_TEMPLATE_SETTINGS}),sync(API_ROOT+"update-site-template-settings",{path:e,value:t}).then(function(e){e.error_message||s(Actions.siteTemplateSettingsUpdated(e)),n(e)})}},siteTemplateSettingsUpdated:function(e){return{type:ActionTypes.SITE_TEMPLATE_SETTINGS_UPDATED,resp:e}},templateSettingsCreated:function(e,t){return{type:ActionTypes.TEMPLATE_SETTINGS_CREATED,site_name:e,data:t}},renameSiteTemplateSettingsSitename:function(e){return{type:ActionTypes.RENAME_SITE_TEMPLATE_SETTINGS_SITENAME,data:e}},deleteSiteTemplateSettings:function(e){return{type:ActionTypes.SITE_TEMPLATE_SETTINGS_DELETED,data:e}}})}(window,document),function(e,t){"use strict";e.Actions=e.Actions||{},Object.assign(e.Actions,{createSection:function(e,t,n,s){return function(i,E){i({type:ActionTypes.CREATE_SECTION}),i({type:ActionTypes.UPDATE_TAGS}),sync(API_ROOT+"create-section",{site:e,name:t,title:n},"POST").then(function(t){t.error_message||(i(Actions.sectionCreated(t.section)),t.tags&&i(Actions.addSectionTags({site_name:e,tags:t.tags}))),s(t.section)})}},sectionCreated:function(e){return{type:ActionTypes.SECTION_CREATED,resp:e}},renameSection:function(e,t,n){return function(s,i){s({type:ActionTypes.UPDATE_SECTION}),s({type:ActionTypes.UPDATE_TAGS}),sync(API_ROOT+"update-section",{path:e,value:t}).then(function(e){e.error_message||(s(Actions.sectionUpdated(e)),s(Actions.renameSectionTags({site_name:e.site,section_name:e.section.name,section_old_name:e.old_name}))),n(e)})}},updateSection:function(e,t,n){return{type:ActionTypes.UPDATE_SECTION,meta:{remote:!0,url:API_ROOT+"update-section",method:"PATCH",data:{path:e,value:t},dispatch:"sectionUpdated",onComplete:n},path:e,value:t}},sectionUpdated:function(e){return{type:ActionTypes.SECTION_UPDATED,resp:e}},renameSectionsSitename:function(e){return{type:ActionTypes.RENAME_SECTIONS_SITENAME,data:e}},deleteSiteSections:function(e){return{type:ActionTypes.DELETE_SITE_SECTIONS,data:e}},resetSection:function(e,t){return{type:ActionTypes.RESET_SECTION,meta:{remote:!0,url:API_ROOT+"reset-section",method:"PATCH",data:{path:e},onComplete:t},path:e}},deleteSection:function(e,t,n){return function(s,i){s({type:ActionTypes.DELETE_SECTION}),s({type:ActionTypes.UPDATE_TAGS}),sync(API_ROOT+"delete-section/"+encodeURIComponent(e)+"/"+encodeURIComponent(t),{},"DELETE").then(function(e){e.error_message||(s(Actions.sectionDeleted(e)),s(Actions.deleteSectionTags({site_name:e.site,section_name:e.name}))),n(e)})}},sectionDeleted:function(e){return{type:ActionTypes.SECTION_DELETED,resp:e}},orderSections:function(e,t,n){return{type:ActionTypes.ORDER_SECTIONS,meta:{remote:!0,method:"PUT",url:API_ROOT+"order-sections",data:{site:e,sections:t},onComplete:n},site:e,sections:t}},sectionBgDelete:function(e,t,n,s){var i=encodeURIComponent(e)+"/"+encodeURIComponent(t)+"/"+encodeURIComponent(n);return{type:ActionTypes.SECTION_BG_DELETE,meta:{remote:!0,url:API_ROOT+"section-bg-delete/"+i,method:"DELETE",onComplete:s}}},sectionBgOrder:function(e,t,n,s){return{type:ActionTypes.SECTION_BG_ORDER,meta:{remote:!0,method:"PUT",url:API_ROOT+"section-bg-order",data:{site:e,section:t,files:n},dispatch:"sectionBgOrdered",onComplete:s},site:e,section:t,files:n}},sectionBgOrdered:function(e){return{type:ActionTypes.SECTION_BG_ORDERED,resp:e}}})}(window,document),function(e,t){"use strict";e.Actions=e.Actions||{},Object.assign(e.Actions,{})}(window,document),function(e,t){"use strict";e.Actions=e.Actions||{},Object.assign(e.Actions,{addSiteTags:function(e){return{type:ActionTypes.ADD_SITE_TAGS,data:e}},addSectionTags:function(e){return{type:ActionTypes.ADD_SECTION_TAGS,data:e}},renameSectionTags:function(e){return{type:ActionTypes.RENAME_SECTION_TAGS,data:e}},renameTagsSitename:function(e){return{type:ActionTypes.RENAME_TAGS_SITENAME,data:e}},deleteSectionTags:function(e){return{type:ActionTypes.DELETE_SECTION_TAGS,data:e}},deleteSiteTags:function(e){return{type:ActionTypes.SITE_TAGS_DELETED,data:e}}})}(window,document),function(e,t){"use strict";function n(e){if(e.status>=200&&e.status<300)return e;var t=new Error(e.statusText);throw t.response=e,t}e.redux_middleware=function(e){return function(t){return function(s){if(s&&s.meta&&s.meta.remote){var i=s.meta.method?s.meta.method:"GET";fetch(s.meta.url,{method:i,headers:{Accept:"application/json","Content-Type":"application/json"},body:"get"===i?void 0:JSON.stringify(s.meta.data)}).then(n).then(function(e){return e.json()}).then(function(t){s.meta&&s.meta.dispatch&&!t.error_message&&e.dispatch(Actions[s.meta.dispatch](t)),s.meta&&s.meta.onComplete&&s.meta.onComplete(t)})["catch"](function(e){console.log("Request failed:",e)})}return t(s)}}}}(window,document),function(e,t){"use strict";e.reducers=e.reducers||{},Object.assign(e.reducers,{sites:function(e,t){var n,s,i;switch(void 0===e&&(e=Immutable.Map()),t.type){case ActionTypes.SET_STATE:return console.log("Sites SET_STATE reducer:",t),Immutable.fromJS(t.state.sites);case ActionTypes.SITE_CREATED:return console.log("Sites reducer:",t),e.set(e.size,Immutable.fromJS(t.data));case ActionTypes.SITE_UPDATED:console.log("Sites reducer:",t),n=t.resp.path.split("/"),i=parseInt(n[1],10),s=t.resp.value;var E=n.slice(2);return e.map(function(e){return e.get("order")===i&&e.getIn(E)!==s?e.setIn(E,s):e});case ActionTypes.SITE_DELETED:return console.log("Sites reducer:",t),e.filter(function(e){return e.get("name")!==t.resp.name}).map(function(e,t){return e.get("order")!==t?e.set("order",t):e});case ActionTypes.ORDER_SITES:return e.map(function(e){var n=e.get("name");""===n&&(n="0");var s=t.sites.indexOf(n);return e.get("order")!==s?e.set("order",s):e});default:return e}}})}(window,document),function(e,t){"use strict";e.reducers=e.reducers||{},Object.assign(e.reducers,{site_settings:function(e,t){switch(void 0===e&&(e=Immutable.Map()),t.type){case ActionTypes.SET_STATE:return console.log("Site settings reducer:",t),Immutable.fromJS(t.state.site_settings);case ActionTypes.SETTINGS_UPDATED:console.log("Settings reducer:",t);var n=t.resp.path.split("/").slice(2),s=t.resp.value;return e.setIn([t.resp.site,n[0],n[1]],s);case ActionTypes.SETTINGS_CREATED:return e.setIn([t.site_name],Immutable.fromJS(t.data));case ActionTypes.RENAME_SETTINGS_SITENAME:var i=t.data.site.get("name");return e.mapKeys(function(e){return e===i?t.data.site_name:e});case ActionTypes.SITE_SETTINGS_DELETED:return e.filter(function(e,n){return n!==t.data.site_name});default:return e}}})}(window,document),function(e,t){"use strict";e.reducers=e.reducers||{},Object.assign(e.reducers,{site_template_settings:function(e,t){switch(void 0===e&&(e=Immutable.Map()),t.type){case ActionTypes.SET_STATE:return console.log("Site template settings reducer:",t),Immutable.fromJS(t.state.site_template_settings);case ActionTypes.SITE_TEMPLATE_SETTINGS_UPDATED:console.log("Template settings reducer:",t);var n=t.resp.path.split("/").slice(2),s=t.resp.value;return e.setIn([t.resp.site,n[0],n[1],n[2]],s);case ActionTypes.TEMPLATE_SETTINGS_CREATED:return e.setIn([t.site_name],Immutable.fromJS(t.data));case ActionTypes.RENAME_SITE_TEMPLATE_SETTINGS_SITENAME:var i=t.data.site.get("name");return e.mapKeys(function(e){return e===i?t.data.site_name:e});case ActionTypes.SITE_TEMPLATE_SETTINGS_DELETED:return e.filter(function(e,n){return n!==t.data.site_name});default:return e}}})}(window,document),function(e,t){"use strict";e.reducers=e.reducers||{},Object.assign(e.reducers,{template_settings:function(e,t){switch(void 0===e&&(e=Immutable.Map()),t.type){case ActionTypes.SET_STATE:return console.log("Template settings reducer:",t),Immutable.fromJS(t.state.template_settings);default:return e}}})}(window,document),function(e,t){"use strict";e.reducers=e.reducers||{},Object.assign(e.reducers,{sections:function(e,t){var n,s,i,E,T;switch(void 0===e&&(e=Immutable.Map()),t.type){case ActionTypes.SET_STATE:return console.log("Sections reducer:",t),Immutable.fromJS(t.state.sections);case ActionTypes.SECTION_CREATED:return e.set(e.size,Immutable.fromJS(t.resp));case ActionTypes.RENAME_SECTIONS_SITENAME:var r=t.data.site.get("name");return T=t.data.site_name,e.map(function(e){return e.get("site_name")===r?e.set("site_name",T):e});case ActionTypes.SECTION_UPDATED:return console.log("Sections reducer:",t),n=t.resp.path.split("/"),s="0"===n[0]?"":n[0],i=parseInt(n[2],10),T=t.resp.value,E=n.slice(3),e.map(function(e){return e.get("site_name")===s&&e.get("order")===i&&e.getIn(E)!==T?e.merge(t.resp.section):e});case ActionTypes.RESET_SECTION:return console.log("Sections reducer:",t),n=t.path.split("/"),s="0"===n[0]?"":n[0],i=parseInt(n[2],10),E=n.slice(3),e.map(function(e){return e.get("site_name")===s&&e.get("order")===i?e.deleteIn(E):e});case ActionTypes.SECTION_DELETED:return console.log("Sections reducer:",t,e),s="0"===t.resp.site?"":t.resp.site,i=-1,e.filter(function(e){return!(e.get("name")===t.resp.name&&e.get("site_name")===s)}).map(function(e){return e.get("site_name")===s&&(i++,e.get("order")!==i)?e.set("order",i):e});case ActionTypes.DELETE_SITE_SECTIONS:return e.filter(function(e){return e.get("site_name")!==t.data.site_name});case ActionTypes.ORDER_SECTIONS:return console.log("Sections reducer:",t),e.map(function(e){if(e.get("site_name")===t.site){var n=t.sections.indexOf(e.get("name"));if(e.get("order")!==n)return e.set("order",n)}return e});case ActionTypes.SECTION_BG_ORDERED:return console.log("Sections reducer:",t),e.map(function(e){return e.get("site_name")===t.resp.site&&e.get("name")===t.resp.section?e.set("mediafolder",t.resp.mediafolder).setIn(["mediaCacheData","file"],t.resp.files):e});default:return e}}})}(window,document),function(e,t){"use strict";e.reducers=e.reducers||{},Object.assign(e.reducers,{entries:function(e,t){switch(void 0===e&&(e=Immutable.Map()),t.type){case ActionTypes.SET_STATE:return console.log("Entries reducer:",t),Immutable.fromJS(t.state.entries);default:return e}}})}(window,document),function(e,t){"use strict";e.reducers=e.reducers||{},Object.assign(e.reducers,{tags:function(e,t){var n=[];switch(void 0===e&&(e=Immutable.Map()),t.type){case ActionTypes.SET_STATE:return console.log("Tags reducer:",t),Immutable.fromJS(t.state.tags);case ActionTypes.ADD_SITE_TAGS:return e.set(t.data.site_name,t.data.tags);case ActionTypes.ADD_SECTION_TAGS:return n=t.data.site_name,e.map(function(e,s){return n===s?e.map(function(e){return e.set(e.size,Immutable.fromJS(t.data.tags))}):e});case ActionTypes.RENAME_SECTION_TAGS:return n="0"===t.data.site_name?"":t.data.site_name,e.map(function(e,s){return n===s?e.map(function(e){return e.map(function(e){return e.getIn(["@attributes","name"])===t.data.section_old_name?e.setIn(["@attributes","name"],t.data.section_name):e})}):e});case ActionTypes.DELETE_SECTION_TAGS:return n="0"===t.data.site_name?"":t.data.site_name,e.map(function(e,s){return n===s?e.map(function(e){return e.filter(function(e){return e.getIn(["@attributes","name"])!==t.data.section_name})}):e});case ActionTypes.RENAME_TAGS_SITENAME:var s=t.data.site.get("name");return e.mapKeys(function(e){return e===s?t.data.site_name:e});case ActionTypes.SITE_TAGS_DELETED:return e.filter(function(e,n){return n!==t.data.site_name});default:return e}}})}(window,document),function(e,t){"use strict";e.root_reducer=Redux.combineReducers(reducers)}(window,document),function(e,t){"use strict";domReady(Templates.load);var n=e.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||Redux.compose;e.redux_store=Redux.createStore(root_reducer,{},n(Redux.applyMiddleware(redux_middleware,ReduxThunk["default"])));var s=getCurrentSite();redux_store.dispatch(Actions.getState(s))}(window,document);
//# sourceMappingURL=maps/ng-backend.min.js.map
